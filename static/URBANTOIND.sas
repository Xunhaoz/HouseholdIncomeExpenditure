LIBNAME FIE1S "C:\Users\leo20\Desktop\Xunhaoz\College\111 Second\經濟系資料分析\sas lesson 3";
LIBNAME FIE2S "C:\Users\leo20\Desktop\Xunhaoz\College\111 Second\經濟系資料分析\sas lesson 7";


DATA SALARY;
SET FIE2S.AMT2011;
RUN;

DATA PERSON;
SET FIE1S.PERSON2011;
RUN;

%MACRO LOOP;
%DO K=2012 %TO 2021;
	DATA PERSON;
	SET PERSON FIE1S.PERSON&K;
	RUN;

	DATA SALARY;
	SET SALARY FIE2S.AMT&K;
	RUN;
%END;
%MEND;

%LOOP;

DATA SALARY;
SET SALARY;
IF PERSON=9 OR PERSON=0 THEN DELETE;
KEEP YEAR ID PERSON ITM40;
RUN;

DATA PERSON;
SET PERSON;
RUN;

PROC SORT DATA=SALARY;
BY YEAR ID PERSON;
RUN;

PROC SORT DATA=PERSON;
BY YEAR ID PERSON;
RUN;

DATA RES;
MERGE PERSON SALARY;
BY YEAR ID PERSON;
IF ITM40=. THEN DELETE;
IF IND=90;
IF WORKPLACE=2 THEN WK2=ITM40; ELSE WK2=0;
IF WORKPLACE=4 THEN WK4=ITM40; ELSE WK4=0;
IF WORKPLACE=5 THEN WK5=ITM40; ELSE WK5=0;
IF WORKPLACE=7 THEN WK7=ITM40; ELSE WK7=0;
IF WORKPLACE=8 THEN WK8=ITM40; ELSE WK8=0;
IF WORKPLACE=9 THEN WK9=ITM40; ELSE WK9=0;
IF WORKPLACE=10 THEN WK10=ITM40; ELSE WK10=0;
IF WORKPLACE=13 THEN WK13=ITM40; ELSE WK13=0;
IF WORKPLACE=14 THEN WK14=ITM40; ELSE WK14=0;
IF WORKPLACE=15 THEN WK15=ITM40; ELSE WK15=0;
IF WORKPLACE=16 THEN WK16=ITM40; ELSE WK16=0;
IF WORKPLACE=17 THEN WK17=ITM40; ELSE WK17=0;
IF WORKPLACE=18 THEN WK18=ITM40; ELSE WK18=0;
IF WORKPLACE=20 THEN WK20=ITM40; ELSE WK20=0;
IF WORKPLACE=63 THEN WK63=ITM40; ELSE WK63=0;
IF WORKPLACE=64 THEN WK64=ITM40; ELSE WK64=0;
IF WORKPLACE=65 THEN WK65=ITM40; ELSE WK65=0;
IF WORKPLACE=66 THEN WK66=ITM40; ELSE WK66=0;
IF WORKPLACE=67 THEN WK67=ITM40; ELSE WK67=0;
IF WORKPLACE=68 OR WORKPLACE=3 THEN WK68=ITM40; ELSE WK68=0;
keep YEAR ID WORKPLACE PERSON WK2-WK68;
RUN;

PROC SORT;
BY WORKPLACE;
RUN;

PROC MEANS;
VAR WK2 WK4 WK5 WK7 WK8 WK9 WK10 WK13 WK14 WK15 WK16 WK17 WK18 WK20 WK63 WK64 WK65 WK66 WK67 WK68;
BY WORKPLACE;
OUTPUT OUT=ANA MEAN=WWK2 WWK4 WWK5 WWK7 WWK8 WWK9 WWK10 WWK13 WWK14 WWK15 WWK16 WWK17 WWK18 WWK20 WWK63 WWK64 WWK65 WWK66 WWK67 WWK68;
RUN;
